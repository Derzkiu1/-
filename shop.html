<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body { background-color: black; color: white; font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
        .header { padding: 10px; background-color: #000; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); }
        .back-button { position: absolute; top: 10px; left: 10px; background-color: rgba(68, 68, 68, 0.7); color: white; border: none; padding: 10px; cursor: pointer; border-radius: 10px; display: flex; align-items: center; justify-content: center; transition: background-color 0.3s; }
        .back-button:hover { background-color: rgba(68, 68, 68, 0.9); }
        .back-button i { margin-right: 5px; }
        .item { margin: 20px auto; padding: 10px; background-color: #333; border-radius: 10px; box-shadow: 0 0 10px rgba(255, 255, 255, 0.3); max-width: 400px; text-align: left; }
        .item img { width: 100px; height: 100px; border-radius: 10px; margin-right: 20px; }
        .item h2 { font-size: 20px; margin-bottom: 5px; }
        .item p { margin: 5px 0; }
        .item button { background-color: rgba(255, 0, 0, 0.7); color: white; border: none; padding: 10px 20px; margin-top: 10px; cursor: pointer; border-radius: 10px; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); transition: box-shadow 0.3s, background-color 0.3s; }
        .item button:disabled { background-color: grey; cursor: not-allowed; }
        .item button:hover { background-color: rgba(255, 0, 0, 0.9); box-shadow: 0 0 20px rgba(220, 20, 60, 0.8); }
        .item button img { width: 20px; height: 20px; margin-right: 5px; opacity: 0.7; }
        .item button:hover img { opacity: 1; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Shop</h1>
        <button class="back-button" onclick="window.location.href = 'index.html'"><i class="fas fa-arrow-left"></i></button>
    </div>
    <div class="item">
        <img src="https://via.placeholder.com/100" alt="Item 1">
        <h2>Помощь бедным</h2>
        <p>Цена: 100</p>
        <p>Доходность в минуту: 50 монет, 10 населения</p>
        <button data-item="Помощь бедным" onclick="buyItem('Помощь бедным')">Купить</button>
    </div>
    <div class="item">
        <img src="https://via.placeholder.com/100" alt="Item 2">
        <h2>Уборка улиц</h2>
        <p>Цена: 250</p>
        <p>Доходность в минуту: 100 монет, 20 населения</p>
        <button data-item="Уборка улиц" onclick="buyItem('Уборка улиц')">Купить</button>
    </div>
    <!-- Add more items here -->
    <script>
        async function buyItem(itemName) {
            try {
                const response = await fetch('users.json');
                const userData = await response.json();
                const user = userData[0]; // Предполагаем, что есть только один пользователь
                const item = user.items.find(i => i.name === itemName);
                if (user.balance >= item.price) {
                    user.balance -= item.price;
                    item.price += item.priceIncrement;
                    item.profit += item.profitIncrement;
                    item.population += item.populationIncrement;
                    item.level += 1;
                    // Сохраняем обновленные данные пользователя и товаров
                    await fetch('/save_data', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(userData)
                    });
                    alert(`Вы успешно купили ${itemName}! Теперь вы будете получать прибыль.`);
                    startHourlyTimer(); // Запускаем таймер после покупки товара
                    startProfitTimer(item); // Запускаем таймер начисления прибыли
                    updateButtonStyle(itemName); // Обновляем стиль кнопки после покупки товара
                } else {
                    alert('Недостаточно средств!');
                }
            } catch (error) {
                console.error('Ошибка при покупке товара:', error);
            }
        }

        // Функция для начисления прибыли от товаров каждую секунду
        function startProfitTimer(item) {
            setInterval(() => {
                const userData = fetch('users.json').then(response => response.json());
                userData.then(data => {
                    const user = data[0];
                    user.balance += item.profit;
                    user.population += item.population;
                    document.getElementById('user-balance').innerText = `Баланс: ${user.balance}`;
                    document.getElementById('user-population').innerText = `Население: ${user.population}`;
                    fetch('/save_data', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                });
            }, 1000); // 1000 milliseconds = 1 second
        }

        // Функция для обновления стиля кнопки в зависимости от баланса игрока
        async function updateButtonStyle(itemName) {
            try {
                const response = await fetch('users.json');
                const userData = await response.json();
                const user = userData[0]; // Предполагаем, что есть только один пользователь
                const item = user.items.find(i => i.name === itemName);
                const button = document.querySelector(`button[data-item="${itemName}"]`);
                if (user.balance >= item.price) {
                    button.style.backgroundColor = 'rgba(255, 0, 0, 0.7)';
                    button.style.cursor = 'pointer';
                    button.disabled = false;
                } else {
                    button.style.backgroundColor = 'grey';
                    button.style.cursor = 'not-allowed';
                    button.disabled = true;
                }
            } catch (error) {
                console.error('Ошибка при обновлении стиля кнопки:', error);
            }
        }
    </script>
</body>
</html>

